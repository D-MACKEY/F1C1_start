if (self.CavalryLogger) { CavalryLogger.start_js_script(document.currentScript); }/*FB_PKG_DELIM*/

__d("LSIssuePointQueryRestoreTask",["LSAppendDataTraceAddon","LSArrayGetObjectAt","LSBase64Encode.nop","LSBinaryToHex.nop","LSCreateDerivedKeys.nop","LSFlushDataTrace.nop","LSGetBlobFromInt64BE.nop","LSGetBlobFromString.nop","LSHmac_v2.nop","LSIssueNewTaskAndGetTaskID","LSLogMebClientEvent.nop","LSOcmfClientMap.nop","LSOpeEncrypt.nop","LSTruncateSortKey.nop","qex"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(g){return c.seq([function(e){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssuePointQueryRestoreTaskStoredProcedure]Beginning execution."),d[3]=function(a){return a==f?f:a}(b("qex")._("1223")),d[3]!==f?d[0]=d[3]:d[0]=!1,d[4]=function(a){return a==f?f:a}(b("qex")._("139")),d[4]!==f?d[1]=d[4]:d[1]=!1,d[0]||d[1]?c.seq([function(d){return a[3]!==f?c.sp(b("LSAppendDataTraceAddon"),a[3],[0,2512],[0,2],f,f):c.resolve()},function(a){return d[5]=!1,d[5]?d[6]=!0:d[6]=!1,d[6]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"),d[15]=c.createArray(),f!==f?d[16]=(d[15].push(f),d[15]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[15],[0,3])):c.resolve()},function(a){return c.islc(c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,[0,80])}),0,c.i64.to_float([0,1])).next().then(function(a,b){var e=a.done;a=a.value;return e?(e=[f,f,f,f,f,[0,1]],d[7]=e[0],d[8]=e[1],d[9]=e[2],d[10]=e[3],d[11]=e[4],d[12]=e[5],e):(b=a.item,d[16]=b.backupTenancy,c.i64.neq(d[16],f)?d[15]=d[16]:d[15]=[0,1],e=[b.backupId,b.deviceId,b.mailboxRootKeyBlob,b.ocmfClientStateBlob,b.encryptionVersion,d[15]],d[7]=e[0],d[8]=e[1],d[9]=e[2],d[10]=e[3],d[11]=e[4],d[12]=e[5],e)})},function(e){return c.i64.neq(d[7],f)?c.seq([function(e){return c.blobs.neq(d[10],f)?c.seq([function(e){return c.nop(b("LSGetBlobFromString.nop"),a[0]).then(function(a){return a=a,d[16]=a[0],a})},function(a){return c.nop(b("LSHmac_v2.nop"),c.blob("dGhyZWFkX2lkX3Njb3Bl"),d[16]).then(function(a){return a=a,d[17]=a[0],a})},function(a){return c.nop(b("LSOcmfClientMap.nop"),d[10],d[17]).then(function(a){return a=a,d[18]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.nop"),d[18]).then(function(a){return a=a,d[19]=a[0],a})},function(a){return d[37]=d[19]==null?"":d[19],c.nop(b("LSGetBlobFromString.nop"),c.i64.to_string(d[7])).then(function(a){return a=a,d[20]=a[0],a})},function(a){return c.nop(b("LSHmac_v2.nop"),c.blob("bWFpbGJveF9pZF9zY29wZQ=="),d[20]).then(function(a){return a=a,d[21]=a[0],a})},function(a){return c.nop(b("LSOcmfClientMap.nop"),d[10],d[21]).then(function(a){return a=a,d[22]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.nop"),d[22]).then(function(a){return a=a,d[23]=a[0],a})},function(e){return c.nop(b("LSGetBlobFromString.nop"),a[1]).then(function(a){return a=a,d[24]=a[0],a})},function(a){return c.nop(b("LSHmac_v2.nop"),c.blob("bWVzc2FnZV9pZF9zY29wZQ=="),d[24]).then(function(a){return a=a,d[25]=a[0],a})},function(a){return c.nop(b("LSOcmfClientMap.nop"),d[10],d[25]).then(function(a){return a=a,d[26]=a[0],a})},function(a){return c.nop(b("LSBase64Encode.nop"),d[26]).then(function(a){return a=a,d[27]=a[0],a})},function(e){return c.blobs.neq(d[9],f)?c.seq([function(e){return a[2]!==f?c.seq([function(e){return d[41]=c.createArray(),d[47]=(d[41].push([0,32]),d[41]),c.nop(b("LSGetBlobFromString.nop"),["thread_ope_key","_",a[0]].join("")).then(function(a){return a=a,d[42]=a[0],a})},function(a){return c.nop(b("LSCreateDerivedKeys.nop"),d[42],f,d[9],d[41]).then(function(a){return a=a,d[43]=a[0],a})},function(a){return d[43]?d[44]=!1:d[44]=!0,d[44]?c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils]Got null keys while deriving message list OPE key. Returning null blobish"),d[47]=c.createArray(),f!==f?d[48]=(d[47].push(f),d[47]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","Got null keys while deriving message list OPE key. Returning null blobish",d[47],[0,3])},function(a){return d[45]=f}]):c.seq([function(a){return c.ntop("Array",b("LSArrayGetObjectAt"),d[43],[0,0]).then(function(a){return a=a,d[47]=a[0],d[48]=a[1],a})},function(a){return d[45]=d[47]}])},function(e){return c.blobs.neq(d[45],f)?c.seq([function(e){return d[49]=function(a){return a==f?f:a}(b("qex")._("1228")),d[49]!==f?d[47]=d[49]:d[47]=!0,d[47]?c.seq([function(e){return c.nop(b("LSGetBlobFromInt64BE.nop"),c.i64.from_string(a[2])).then(function(a){return a=a,d[50]=a[0],a})},function(a){return c.nop(b("LSTruncateSortKey.nop"),d[50]).then(function(a){return a=a,d[51]=a[0],a})},function(a){return c.nop(b("LSOpeEncrypt.nop"),d[45],d[51],[0,16]).then(function(a){return a=a,d[52]=a[0],a})},function(a){return c.nop(b("LSBinaryToHex.nop"),d[52]).then(function(a){return a=a,d[53]=a[0],a})},function(a){return d[48]=d[53]==null?"":d[53]}]):c.resolve(d[48]=a[2])},function(a){return d[46]=d[48]}]):c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils]OPE key is null"),d[47]=c.createArray(),f!==f?d[48]=(d[47].push(f),d[47]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","OPE key is null",d[47],[0,3])},function(a){return d[46]=f}])},function(a){return d[40]=d[46]}]):c.resolve(d[40]=f)},function(a){return d[28]=d[40]}]):c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBCryptoUtils]Mailbox root key is null"),d[40]=c.createArray(),f!==f?d[41]=(d[40].push(f),d[40]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBCryptoUtils","Mailbox root key is null",d[40],[0,3])},function(a){return d[28]=f}])},function(d){return a[3]!==f?c.sp(b("LSAppendDataTraceAddon"),a[3],[0,3604],[0,2],f,f):c.resolve()},function(a){return d[29]=!1,d[29]?d[30]=!0:d[30]=!1,d[30]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"),d[40]=c.createArray(),f!==f?d[41]=(d[40].push(f),d[40]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[40],[0,3])):c.resolve()},function(a){return c.i64.gt([0,0],[0,0])?d[31]=c.i64.add(c.i64.of_float(Date.now()),[0,0]):d[31]=[0,0],c.sp(b("LSIssueNewTaskAndGetTaskID"),"encrypted_backups_restore",[0,50015],"",f,f,[0,0],[0,0],f,f,d[31]).then(function(a){return a=a,d[32]=a[0],a})},function(d){return a[3]!==f?c.sp(b("LSAppendDataTraceAddon"),a[3],[0,3601],[0,2],f,f):c.resolve()},function(a){return d[33]=!1,d[33]?d[34]=!0:d[34]=!1,d[34]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"),d[40]=c.createArray(),f!==f?d[41]=(d[40].push(f),d[40]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[40],[0,3])):c.resolve()},function(b){return c.db.table(190).add({taskId:d[32],mailboxPartialId:d[23]==null?"":d[23],listId:d[37],numItems:[0,1],contentType:[0,1],startSortKey:d[28],traceId:a[3],isPointQuery:!0,messagePartialId:d[27]==null?"":d[27],newerNumItems:[0,0]})},function(d){return a[3]!==f?c.sp(b("LSAppendDataTraceAddon"),a[3],[0,3605],[0,2],f,f):c.resolve()},function(a){return d[35]=!1,d[35]?d[36]=!0:d[36]=!1,d[36]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"),d[40]=c.createArray(),f!==f?d[41]=(d[40].push(f),d[40]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[40],[0,3])):c.resolve()},function(b){return c.db.table(180).add({taskId:d[32],listId:d[37],threadId:a[0]})},function(d){return a[3]!==f?c.sp(b("LSAppendDataTraceAddon"),a[3],[0,2513],[0,2],f,f):c.resolve()},function(a){return d[38]=!1,d[38]?d[39]=!0:d[39]=!1,d[39]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"),d[40]=c.createArray(),f!==f?d[41]=(d[40].push(f),d[40]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[40],[0,3])):c.resolve()},function(a){return d[15]=d[32]}]):c.seq([function(e){return d[16]="Missing ocmf_client_state for IssuePointQueryRestoreTask",d[16]!==f?c.seq([function(e){return d[20]=["[EncryptedBackups][LSEncryptedBackupsIssuePointQueryRestoreTaskStoredProcedure]","",d[16]].join(""),function(a){c.logger(a).mustfix(a)}(d[20]),d[17]=c.createArray(),a[3]!==f?d[21]=(d[17].push(a[3]),d[17]):0,c.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssuePointQueryRestoreTaskStoredProcedure",d[16],d[17],[0,3])},function(e){return a[3]!==f?c.seq([function(e){return a[3]!==f?c.sp(b("LSAppendDataTraceAddon"),a[3],[0,85],[0,2],d[20],f):c.resolve()},function(a){return d[21]=!1,d[21]?d[22]=!0:d[22]=!1,d[22]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"),d[23]=c.createArray(),f!==f?d[24]=(d[23].push(f),d[23]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[23],[0,3])):c.resolve()}]):c.resolve()},function(d){return a[3]!==f?c.nop(b("LSFlushDataTrace.nop"),a[3]):c.resolve()},function(a){return d[18]=!1,d[18]?d[19]=!0:d[19]=!1,d[19]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"),d[21]=c.createArray(),f!==f?d[22]=(d[21].push(f),d[21]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[21],[0,3])):c.resolve()}]):c.seq([function(e){return a[3]!==f?c.seq([function(d){return a[3]!==f?c.sp(b("LSAppendDataTraceAddon"),a[3],[0,85],[0,2],["[EncryptedBackups][LSEncryptedBackupsIssuePointQueryRestoreTaskStoredProcedure]","",""].join(""),f):c.resolve()},function(a){return d[19]=!1,d[19]?d[20]=!0:d[20]=!1,d[20]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"),d[21]=c.createArray(),f!==f?d[22]=(d[21].push(f),d[21]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[21],[0,3])):c.resolve()}]):c.resolve()},function(d){return a[3]!==f?c.nop(b("LSFlushDataTrace.nop"),a[3]):c.resolve()},function(a){return d[17]=!1,d[17]?d[18]=!0:d[18]=!1,d[18]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"),d[19]=c.createArray(),f!==f?d[20]=(d[19].push(f),d[19]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[19],[0,3])):c.resolve()}])},function(a){return d[15]=[-1,4294967295]}])},function(a){return d[14]=d[15]}]):c.seq([function(e){return d[15]="Missing backup_id for IssuePointQueryRestoreTask",d[15]!==f?c.seq([function(e){return d[19]=["[EncryptedBackups][LSEncryptedBackupsIssuePointQueryRestoreTaskStoredProcedure]","",d[15]].join(""),function(a){c.logger(a).mustfix(a)}(d[19]),d[16]=c.createArray(),a[3]!==f?d[20]=(d[16].push(a[3]),d[16]):0,c.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssuePointQueryRestoreTaskStoredProcedure",d[15],d[16],[0,3])},function(e){return a[3]!==f?c.seq([function(e){return a[3]!==f?c.sp(b("LSAppendDataTraceAddon"),a[3],[0,85],[0,2],d[19],f):c.resolve()},function(a){return d[20]=!1,d[20]?d[21]=!0:d[21]=!1,d[21]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"),d[22]=c.createArray(),f!==f?d[23]=(d[22].push(f),d[22]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[22],[0,3])):c.resolve()}]):c.resolve()},function(d){return a[3]!==f?c.nop(b("LSFlushDataTrace.nop"),a[3]):c.resolve()},function(a){return d[17]=!1,d[17]?d[18]=!0:d[18]=!1,d[18]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"),d[20]=c.createArray(),f!==f?d[21]=(d[20].push(f),d[20]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[20],[0,3])):c.resolve()}]):c.seq([function(e){return a[3]!==f?c.seq([function(d){return a[3]!==f?c.sp(b("LSAppendDataTraceAddon"),a[3],[0,85],[0,2],["[EncryptedBackups][LSEncryptedBackupsIssuePointQueryRestoreTaskStoredProcedure]","",""].join(""),f):c.resolve()},function(a){return d[18]=!1,d[18]?d[19]=!0:d[19]=!1,d[19]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"),d[20]=c.createArray(),f!==f?d[21]=(d[20].push(f),d[20]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[20],[0,3])):c.resolve()}]):c.resolve()},function(d){return a[3]!==f?c.nop(b("LSFlushDataTrace.nop"),a[3]):c.resolve()},function(a){return d[16]=!1,d[16]?d[17]=!0:d[17]=!1,d[17]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"),d[18]=c.createArray(),f!==f?d[19]=(d[18].push(f),d[18]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[18],[0,3])):c.resolve()}])},function(a){return d[14]=[-1,4294967295]}])},function(a){return d[2]=d[14]}]):c.seq([function(e){return d[5]="point query restore is disabled",d[5]!==f?c.seq([function(e){return d[9]=["[EncryptedBackups][LSEncryptedBackupsIssuePointQueryRestoreTaskStoredProcedure]","",d[5]].join(""),function(a){c.logger(a).mustfix(a)}(d[9]),d[6]=c.createArray(),a[3]!==f?d[10]=(d[6].push(a[3]),d[6]):0,c.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsIssuePointQueryRestoreTaskStoredProcedure",d[5],d[6],[0,3])},function(e){return a[3]!==f?c.seq([function(e){return a[3]!==f?c.sp(b("LSAppendDataTraceAddon"),a[3],[0,85],[0,2],d[9],f):c.resolve()},function(a){return d[10]=!1,d[10]?d[11]=!0:d[11]=!1,d[11]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"),d[12]=c.createArray(),f!==f?d[13]=(d[12].push(f),d[12]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[12],[0,3])):c.resolve()}]):c.resolve()},function(d){return a[3]!==f?c.nop(b("LSFlushDataTrace.nop"),a[3]):c.resolve()},function(a){return d[7]=!1,d[7]?d[8]=!0:d[8]=!1,d[8]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"),d[10]=c.createArray(),f!==f?d[11]=(d[10].push(f),d[10]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[10],[0,3])):c.resolve()}]):c.seq([function(e){return a[3]!==f?c.seq([function(d){return a[3]!==f?c.sp(b("LSAppendDataTraceAddon"),a[3],[0,85],[0,2],["[EncryptedBackups][LSEncryptedBackupsIssuePointQueryRestoreTaskStoredProcedure]","",""].join(""),f):c.resolve()},function(a){return d[8]=!1,d[8]?d[9]=!0:d[9]=!1,d[9]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"),d[10]=c.createArray(),f!==f?d[11]=(d[10].push(f),d[10]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[10],[0,3])):c.resolve()}]):c.resolve()},function(d){return a[3]!==f?c.nop(b("LSFlushDataTrace.nop"),a[3]):c.resolve()},function(a){return d[6]=!1,d[6]?d[7]=!0:d[7]=!1,d[7]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"),d[8]=c.createArray(),f!==f?d[9]=(d[8].push(f),d[8]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[8],[0,3])):c.resolve()}])},function(a){return d[2]=[-1,4294967295]}])},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsIssuePointQueryRestoreTaskStoredProcedure]Finishing execution."),e[0]=d[2]}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSSerializeThreadListKey",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[],d=[];return function(a){b.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsSerializeThreadListKeyStoredProcedure]Beginning execution."),c[0]=b.createArray(),c[2]=(c[0].push(a[0]),c[0]),c[2]=(c[0].push(a[1]),c[0]),c[2]=(c[0].push(a[2]),c[0]),c[1]=b.toJSON(c[0]),function(a){b.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsSerializeThreadListKeyStoredProcedure]Finishing execution."),d[0]=c[1],b.resolve(d)}e.exports=a}),null);
__d("LSUploadMessage",["LSAppendDataTraceAddon","LSCreateDataTraceID.nop","LSIssueNewTaskAndGetTaskID","LSLogMebClientEvent.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsUploadMessageStoredProcedure]Beginning execution."),c.islc(c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,[0,80])}),0,c.i64.to_float([0,1])).next().then(function(a,b){var e=a.done;a=a.value;return e?(e=[f,f,f,f,f,[0,1]],d[0]=e[0],d[1]=e[1],d[2]=e[2],d[3]=e[3],d[4]=e[4],d[5]=e[5],e):(b=a.item,d[8]=b.backupTenancy,c.i64.neq(d[8],f)?d[7]=d[8]:d[7]=[0,1],e=[b.backupId,b.deviceId,b.mailboxRootKeyBlob,b.ocmfClientStateBlob,b.encryptionVersion,d[7]],d[0]=e[0],d[1]=e[1],d[2]=e[2],d[3]=e[3],d[4]=e[4],d[5]=e[5],e)})},function(e){return c.i64.neq(d[0],f)&&c.i64.neq(d[1],f)&&c.blobs.neq(d[3],f)&&!0?c.seq([function(e){return a[5]!==f?c.resolve(d[7]=a[5]):c.seq([function(a){return c.islc(c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,[0,80])&&c.i64.eq(a.backupTenancy,[0,2])}),0,c.i64.to_float([0,1])).next().then(function(a,b){b=a.done;a=a.value;return b?d[9]=!1:(a.item,d[9]=!0)})},function(a){return d[9]?d[11]=c.i64.or_([0,72],[0,128]):d[11]=[0,72],c.nop(b("LSCreateDataTraceID.nop")).then(function(a){return a=a,d[12]=a[0],a})},function(a){return d[13]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils]",d[13],"EncryptedBackups MCD Trace ID",d[13],c.i64.to_string(d[11])].join("")),c.db.table(153).add({traceId:d[12],initTimestampMs:c.i64.of_float(Date.now()),traceType:d[11],shouldFlush:!1,contextThree:"backup_upload"})},function(a){return d[14]=!1,d[14]?d[15]=!0:d[15]=!1,d[15]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"),d[16]=c.createArray(),f!==f?d[17]=(d[16].push(f),d[16]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[16],[0,3])):c.resolve()},function(a){return d[7]=d[12]}])},function(e){return c.i64.eq(a[4],[0,1])?c.seq([function(a){return d[7]!==f?c.sp(b("LSAppendDataTraceAddon"),d[7],[0,1427],[0,2],f,["50004",",","10152"].join("")):c.resolve()},function(a){return d[9]=!1,d[9]?d[10]=!0:d[10]=!1,d[10]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"),d[11]=c.createArray(),f!==f?d[12]=(d[11].push(f),d[11]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[11],[0,3])):c.resolve()}]):c.seq([function(a){return d[7]!==f?c.sp(b("LSAppendDataTraceAddon"),d[7],[0,1427],[0,2],f,["50004",",","10153"].join("")):c.resolve()},function(a){return d[9]=!1,d[9]?d[10]=!0:d[10]=!1,d[10]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"),d[11]=c.createArray(),f!==f?d[12]=(d[11].push(f),d[11]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[11],[0,3])):c.resolve()}])},function(a){return c.sp(b("LSIssueNewTaskAndGetTaskID"),"encrypted_backups_upload",[0,319],"",f,f,[0,0],[0,0],[0,93],f,[0,0]).then(function(a){return a=a,d[8]=a[0],a})},function(e){return c.i64.eq(d[8],[-1,4294967295])?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsUploadMessageStoredProcedure]issueNewTaskAndGetTaskIdFromParams failed"),d[9]=c.createArray(),f!==f?d[10]=(d[9].push(f),d[9]):0,c.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsUploadMessageStoredProcedure","issueNewTaskAndGetTaskIdFromParams failed",d[9],[0,3])):c.db.table(177).add({pk:void 0,pendingBackupTaskId:d[8],persistentId:"",actionType:a[4],contentType:[0,1],backupStatus:[0,1],listKey:a[0],uniqueKey:a[1],sortKey:c.i64.to_string(a[2]),echoContent:a[3],lsTraceId:d[7]})}]):c.resolve()},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsUploadMessageStoredProcedure]Finishing execution.")}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSUploadThread",["LSAppendDataTraceAddon","LSCreateDataTraceID.nop","LSIssueNewTaskAndGetTaskID","LSLogMebClientEvent.nop","LSSerializeThreadListKey"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(e){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsUploadThreadStoredProcedure]Beginning execution."),c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,[0,80])}).next().then(function(e,g){var h=e.done;e=e.value;return h?function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsUploadThreadStoredProcedure]backup_id is not available"):(g=e.item,c.seq([function(a){return c.islc(c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,[0,80])&&c.i64.eq(a.backupTenancy,[0,2])}),0,c.i64.to_float([0,1])).next().then(function(a,b){b=a.done;a=a.value;return b?d[1]=!1:(a.item,d[1]=!0)})},function(a){return d[1]?d[3]=c.i64.or_([0,72],[0,128]):d[3]=[0,72],c.nop(b("LSCreateDataTraceID.nop")).then(function(a){return a=a,d[4]=a[0],a})},function(a){return d[5]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils]",d[5],"EncryptedBackups MCD Trace ID",d[5],c.i64.to_string(d[3])].join("")),c.db.table(153).add({traceId:d[4],initTimestampMs:c.i64.of_float(Date.now()),traceType:d[3],shouldFlush:!1,contextThree:"backup_upload"})},function(a){return d[6]=!1,d[6]?d[7]=!0:d[7]=!1,d[7]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"),d[12]=c.createArray(),f!==f?d[13]=(d[12].push(f),d[12]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[12],[0,3])):c.resolve()},function(a){return d[4]!==f?c.sp(b("LSAppendDataTraceAddon"),d[4],[0,1427],[0,2],f,["50003"].join("")):c.resolve()},function(a){return d[8]=!1,d[8]?d[9]=!0:d[9]=!1,d[9]?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"),d[12]=c.createArray(),f!==f?d[13]=(d[12].push(f),d[12]):0,c.nop(b("LSLogMebClientEvent.nop"),"MEBTraceUtils","LSDataTraceMciTraceLog native op not supported",d[12],[0,3])):c.resolve()},function(e){return c.sp(b("LSSerializeThreadListKey"),a[1],c.i64.to_string(g.backupId),a[2]).then(function(a){return a=a,d[10]=a[0],a})},function(a){return c.sp(b("LSIssueNewTaskAndGetTaskID"),"encrypted_backups_upload",[0,319],"",f,f,[0,0],[0,0],[0,93],f,[0,0]).then(function(a){return a=a,d[11]=a[0],a})},function(e){return c.i64.eq(d[11],[-1,4294967295])?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsUploadThreadStoredProcedure]issueNewTaskAndGetTaskIdFromParams failed"),d[12]=c.createArray(),f!==f?d[13]=(d[12].push(f),d[12]):0,c.nop(b("LSLogMebClientEvent.nop"),"LSEncryptedBackupsUploadThreadStoredProcedure","issueNewTaskAndGetTaskIdFromParams failed",d[12],[0,3])):c.db.table(177).add({pk:void 0,pendingBackupTaskId:d[11],persistentId:"",actionType:a[5],contentType:[0,2],backupStatus:[0,1],listKey:d[10],uniqueKey:a[0],sortKey:c.i64.to_string(a[3]),echoContent:a[4],lsTraceId:d[4]})}]))})},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsUploadThreadStoredProcedure]Finishing execution.")}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("EncryptedBackupsDYIPasswordReauthDialogQuery_facebookRelayOperation",[],(function(a,b,c,d,e,f){e.exports="5590203607685664"}),null);
__d("EncryptedBackupsDYIPasswordReauthDialogQuery$Parameters",["EncryptedBackupsDYIPasswordReauthDialogQuery_facebookRelayOperation"],(function(a,b,c,d,e,f){"use strict";a={kind:"PreloadableConcreteRequest",params:{id:b("EncryptedBackupsDYIPasswordReauthDialogQuery_facebookRelayOperation"),metadata:{},name:"EncryptedBackupsDYIPasswordReauthDialogQuery",operationKind:"query",text:null}};e.exports=a}),null);
__d("MDSProgressRing.react",["CometProgressRingDeterminate.react","react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react");function a(a){var b=a.color;b=b===void 0?"light":b;var d=a.percentage;d=d===void 0?0:d;a=a.size;a=a===void 0?16:a;return h.jsx("div",{className:"xurb0ha xwib8y2 x1sxyh0 x1y1aw1k xl56j7k x78zum5 xww2gxu x18nykt9 xudhj91 x14yjl9h x1qhmfi1 x6s0dn4",children:h.jsx(c("CometProgressRingDeterminate.react"),{color:b,percentage:d,size:a})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MDSToast.react",["fbt","BaseTheme.react","CometRow.react","CometRowItem.react","CometTheme.react","MDSButton.react","MDSCircleButton.react","MDSIcon.react","MDSProfilePhoto.react","MDSProgressRing.react","MDSText.react","MDSTextPairing.react","MessengerCross.svg.react","SVGIcon","react","stylex"],(function(a,b,c,d,e,f,g,h){"use strict";var i=d("react"),j={dark:{"card-background":"#333333"},light:{},type:"VARIABLES"},k={dark:{"secondary-button-background":"rgba(255, 255, 255, 0.14)"},light:{"secondary-button-background":"rgba(0, 0, 0, 0.04)"},type:"VARIABLES"},l={callToActionSection:{display:"x78zum5",flexDirection:"x1q0g3np",paddingBottom:"x1120s5i"},callToActionSpacer:{flexShrink:"x2lah0s",width:"x1xc55vz"},icon:{minWidth:"xnei2rj"},root:{backgroundColor:"x1jx94hy",borderTopStartRadius:"xyi19xy",borderTopEndRadius:"x1ccrb07",borderBottomEndRadius:"xtf3nb5",borderBottomStartRadius:"x1pc53ja",boxShadow:"xdy0x9s",width:"x1t2nb6l"}};function a(a){var b=a.actions,e=a.body,f=a.impressionLoggingRef,g=a.onDismiss,m=a.startAddOn,n=a.testid;n=a.title;a=a.withCloseButton;a=a===void 0?!1:a;var o=null;if(n!=null&&e!=null)o=i.jsx(c("MDSTextPairing.react"),{body:e,bodyColor:"secondaryOnMedia",bodyLineLimit:2,headline:n,headlineColor:"white",headlineLineLimit:2,level:4,reduceEmphasis:!0});else{n=n!=null?n:e;o=i.jsx(c("MDSText.react"),{color:"white",numberOfLines:2,type:"headline4",children:n})}return i.jsx(c("BaseTheme.react"),{config:j,children:i.jsx(c("CometTheme.react"),{role:"alert",testid:void 0,theme:"dark",xstyle:l.root,children:i.jsxs(i.Fragment,{children:[i.jsxs(c("CometRow.react"),{paddingHorizontal:12,paddingVertical:8,ref:f,spacingHorizontal:12,spacingVertical:8,testid:void 0,verticalAlign:"top",children:[m!=null?i.jsx(c("CometRowItem.react"),{xstyle:l.icon,children:m.type==="photo"?i.jsx(c("MDSProfilePhoto.react"),{size:36,source:{uri:m.source}}):m.type==="progressRing"?i.jsx(c("BaseTheme.react"),{config:k,children:i.jsx(c("MDSProgressRing.react"),{color:"light",percentage:m.source,size:20})}):i.jsx(c("MDSIcon.react"),{backgroundEnabled:!0,color:"white",icon:m.source,size:28})}):null,i.jsx(c("CometRowItem.react"),{expanding:!0,verticalAlign:"center",children:o}),a&&i.jsx(c("CometRowItem.react"),{verticalAlign:"top",children:i.jsx(c("MDSCircleButton.react"),{color:"white",icon:d("SVGIcon").svgIcon(c("MessengerCross.svg.react")),label:h._("__JHASH__tnRfHlva-bL__JHASH__"),onPress:g,size:28})})]}),b!=null?i.jsx(c("CometRow.react"),{paddingVertical:4,children:i.jsx(c("CometRowItem.react"),{expanding:!0,children:i.jsxs("div",{className:c("stylex")(l.callToActionSection),children:[i.jsx(c("MDSButton.react"),{label:b.primaryCallToAction.label,onPress:function(a){b.primaryCallToAction.onPress(a),g()},size:36,type:"secondary"}),i.jsx("div",{className:c("stylex")(l.callToActionSpacer)}),i.jsx(c("MDSButton.react"),{label:b.secondaryCallToAction.label,onPress:function(a){b.secondaryCallToAction.onPress(a),g()},size:36,type:"secondary"})]})})}):null]})})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MAWBridgeIssuePointQueryHandler.bs",["LS.bs","LSEncryptedBackupsBackupTenancy.bs","LSIssuePointQueryRestoreTask","MAWEncryptedBackupUtils.bs","Promise","bs_caml"],(function(a,b,c,d,e,f){"use strict";function a(a,c){return b("MAWEncryptedBackupUtils.bs").getBackupTenancy(a,void 0).then(function(d){if(d===void 0)return b("Promise").resolve(void 0);if(!b("bs_caml").i64_eq(d,b("LSEncryptedBackupsBackupTenancy.bs").production))return b("Promise").resolve(void 0);d=c.startSortKey;if(d!==void 0)return b("LSIssuePointQueryRestoreTask")(c.threadId,c.messageId,d,void 0,b("LS.bs").make(a)).then(function(a){});else return b("LSIssuePointQueryRestoreTask")(c.threadId,c.messageId,void 0,void 0,b("LS.bs").make(a)).then(function(a){})})}f.call=a}),null);
__d("ArmadilloDataTraceCheckPoint.bs",[],(function(a,b,c,d,e,f){"use strict";a=[0,63];b=[0,65];c=[0,98];d=[0,504];e=[0,1e3];var g=[0,1001],h=[0,1204],i=[0,1210],j=[0,1224],k=[0,1234],l=[0,1225];f.traceGroupMessage=a;f.armadilloActMessageSend=b;f.traceCreated=c;f.richMediaMediaSendAttachmentType=d;f.traceTextMessage=e;f.traceMediaMessage=g;f.advancedCryptoMEMSendTaskComplete=h;f.deliveryReceiptReceived=i;f.advancedCryptoMEMEncryptionDeviceCount=j;f.advancedCryptoGroupDualSend=k;f.advancedCryptoDualSend=l}),null);
__d("MAWBridgeTraceUtils.bs",["Promise","ReQL.bs","bs_caml","bs_caml_array"],(function(a,b,c,d,e,f){"use strict";function a(a,c,d){return b("ReQL.bs").toArray(b("ReQL.bs").filter(b("ReQL.bs").fromTableAscending(a.table("data_trace_meta")),function(a){var e=a.contextThree;if(e!==void 0&&c===e&&b("bs_caml").i64_eq(a.traceType,d))return a.shouldFlush===!1;else return!1})).then(function(a){if(a.length!==0)return b("Promise").resolve(b("bs_caml_array").get(a,0).traceId);else return b("Promise").resolve(void 0)})}f.getTraceId=a}),null);
__d("MAWBridgeStartTraceHandler.bs",["ArmadilloDataTraceCheckPoint.bs","ArmadilloDataTraceType.bs","LS.bs","LSAppendDataTraceAddon","LSDataTraceTag.bs","LSRequestId","MAWBackendBridge.bs","MAWBridgeTraceUtils.bs","MAWMsg.bs","MAWTimeUtils","Promise","bs_caml","bs_caml_int64","bs_curry","killswitch","promiseDone","recoverableViolation"],(function(a,b,c,d,e,f){"use strict";function g(a,c,d){return a.table("data_trace_meta").add({traceId:d,initTimestampMs:b("MAWTimeUtils").toTimestamp(c.ts),foregroundTimestampMs:b("bs_caml_int64").zero,traceType:c.traceType,shouldFlush:!1,contextOne:void 0,contextTwo:void 0,contextThree:c.externalId,predefinedId:void 0}).then(function(c){return b("LSAppendDataTraceAddon")(d,b("ArmadilloDataTraceCheckPoint.bs").traceCreated,b("bs_caml_int64").neg_one,void 0,void 0,b("LS.bs").make(a))})}function a(a,c){if(!b("killswitch")("MESSENGER_WEB_DATA_TRACE_ID")&&c.ack===7)return b("MAWBridgeTraceUtils.bs").getTraceId(a,c.externalId,c.traceType).then(function(d){if(d!==void 0)return window.Promise.resolve(void 0);else{var e=b("LSRequestId").generate();d=c.traceType;if(b("bs_caml").i64_eq(d,b("ArmadilloDataTraceType.bs").armadilloMessageSend))return g(a,c,e).then(function(d){d=c.isDS;var f=c.openMessageOtid,g=c.threadType,h=c.openMessageParticipantCount,i=c.participantCount;if(d&&f!==void 0)if(g)if(h!==void 0&&i!==void 0)return b("LSAppendDataTraceAddon")(e,b("ArmadilloDataTraceCheckPoint.bs").advancedCryptoGroupDualSend,b("bs_caml_int64").neg_one,void 0,f+","+String(h)+","+String(i),b("LS.bs").make(a));else return b("Promise").resolve(void 0);else return b("LSAppendDataTraceAddon")(e,b("ArmadilloDataTraceCheckPoint.bs").advancedCryptoDualSend,b("bs_caml_int64").neg_one,void 0,f,b("LS.bs").make(a));else return b("Promise").resolve(void 0)}).then(function(d){if(c.isDS){d=c.threadJid;return b("bs_curry")._1(b("MAWBackendBridge.bs").getThreadIdByChatJid({chatJid:d}).sendAndReceive,void 0).then(function(c){if(c==null){b("recoverableViolation")("Unable to find thread from jid","messenger_e2ee_sweb");return b("Promise").resolve(void 0)}else return b("bs_curry")._1(b("MAWBackendBridge.bs").getAllThreadDevicesCount({threadKey:c}).sendAndReceive,void 0).then(function(c){return b("LSAppendDataTraceAddon")(e,b("ArmadilloDataTraceCheckPoint.bs").advancedCryptoMEMEncryptionDeviceCount,b("bs_caml_int64").neg_one,void 0,String(c),b("LS.bs").make(a))})})}else return b("Promise").resolve(void 0)}).then(function(d){if(c.threadType===1)return b("LSAppendDataTraceAddon")(e,b("ArmadilloDataTraceCheckPoint.bs").traceGroupMessage,b("bs_caml_int64").neg_one,void 0,void 0,b("LS.bs").make(a));else return b("Promise").resolve(void 0)}).then(function(d){if(c.isFirstMsg)return b("LSAppendDataTraceAddon")(e,b("ArmadilloDataTraceCheckPoint.bs").armadilloActMessageSend,b("bs_caml_int64").neg_one,void 0,"first_msg=1",b("LS.bs").make(a));else return b("Promise").resolve(void 0)}).then(function(d){d=c.type_;d=d===b("MAWMsg.bs").text?b("ArmadilloDataTraceCheckPoint.bs").traceTextMessage:d===b("MAWMsg.bs").ptt||d===b("MAWMsg.bs").image||d===b("MAWMsg.bs").video||d===b("MAWMsg.bs").gif?b("ArmadilloDataTraceCheckPoint.bs").traceMediaMessage:void 0;if(d===void 0)return window.Promise.resolve(d);var f=b("LSAppendDataTraceAddon")(e,d,b("bs_caml_int64").neg_one,void 0,void 0,b("LS.bs").make(a));b("promiseDone")(f,void 0,void 0);return b("Promise").resolve(d)}).then(function(d){if(d===void 0)return window.Promise.resolve(void 0);if(!b("bs_caml").i64_eq(d,b("ArmadilloDataTraceCheckPoint.bs").traceMediaMessage))return window.Promise.resolve(void 0);d=c.type_;d=d===b("MAWMsg.bs").image?b("LSDataTraceTag.bs").image:d===b("MAWMsg.bs").ptt?b("LSDataTraceTag.bs").audio:d===b("MAWMsg.bs").video?b("LSDataTraceTag.bs").video:d===b("MAWMsg.bs").gif?b("LSDataTraceTag.bs").animatedImage:b("LSDataTraceTag.bs").none;return b("LSAppendDataTraceAddon")(e,b("ArmadilloDataTraceCheckPoint.bs").richMediaMediaSendAttachmentType,b("bs_caml_int64").neg_one,void 0,String(d),b("LS.bs").make(a))});else return g(a,c,e)}});else return window.Promise.resolve(void 0)}f.call=a}),null);
__d("MAWBridgeStartTraceWithTraceIdHandler.bs",["MAWTimeUtils","WATimeUtils","bs_caml_int64","killswitch"],(function(a,b,c,d,e,f){"use strict";function a(a,c){if(b("killswitch")("MESSENGER_WEB_DATA_TRACE_ID"))return window.Promise.resolve(void 0);else return a.table("data_trace_meta").add({traceId:c.traceId,initTimestampMs:b("MAWTimeUtils").toTimestamp(b("WATimeUtils").unixTime()),foregroundTimestampMs:b("bs_caml_int64").zero,traceType:c.traceType,shouldFlush:!1,contextOne:void 0,contextTwo:void 0,contextThree:c.traceContext,predefinedId:void 0})}f.call=a}),null);
__d("MAWBridgeTraceRecordCheckpointHandler.bs",["LS.bs","LSAppendDataTraceAddon","LSFlushDataTrace.bs","Promise","bs_caml_int64"],(function(a,b,c,d,e,f){"use strict";function a(a,c){var d=c.checkPointId,e=c.errorMessage,f=c.tags;if(e!==void 0)if(f!==void 0)return b("LSAppendDataTraceAddon")(c.dataTraceId,d,b("bs_caml_int64").neg_one,e,f,b("LS.bs").make(a)).then(function(d){if(c.shouldFlush)return b("LSFlushDataTrace.bs").call(a,0,c.dataTraceId);else return b("Promise").resolve(void 0)});else return b("LSAppendDataTraceAddon")(c.dataTraceId,d,b("bs_caml_int64").neg_one,e,void 0,b("LS.bs").make(a)).then(function(d){if(c.shouldFlush)return b("LSFlushDataTrace.bs").call(a,0,c.dataTraceId);else return b("Promise").resolve(void 0)});else if(f!==void 0)return b("LSAppendDataTraceAddon")(c.dataTraceId,d,b("bs_caml_int64").neg_one,void 0,f,b("LS.bs").make(a)).then(function(d){if(c.shouldFlush)return b("LSFlushDataTrace.bs").call(a,0,c.dataTraceId);else return b("Promise").resolve(void 0)});else return b("LSAppendDataTraceAddon")(c.dataTraceId,d,b("bs_caml_int64").neg_one,void 0,void 0,b("LS.bs").make(a)).then(function(d){if(c.shouldFlush)return b("LSFlushDataTrace.bs").call(a,0,c.dataTraceId);else return b("Promise").resolve(void 0)})}f.call=a}),null);
__d("LSEncryptedBackupsDYIState.bs",["bs_caml_int64"],(function(a,b,c,d,e,f){"use strict";a=b("bs_caml_int64").zero;c=b("bs_caml_int64").one;d=[0,2];f.backupRestoreInProgress=a;f.backupRestoreSuccessful=c;f.backupRestoreError=d}),null);
__d("MAWBackendBridgeWrapper",["MAWBackendBridge.re"],(function(a,b,c,d,e,f,g){"use strict";function h(a){switch(a.TAG){case 0:return{tag:"TextMsg",value:a._0};case 1:return{tag:"PhotoMsg",value:a._0};case 2:return{tag:"VideoMsg",value:a._0};case 3:return{tag:"AudioMsg",value:a._0};case 4:return{tag:"GifMsg",value:a._0};case 5:return{tag:"StickerMsg",value:a._0}}}function i(a){return babelHelpers["extends"]({},a,{messages:a.messages.map(h)})}function j(a){var b={};for(var c in a)b[c]=i(a[c]);return b}function a(a){var b=d("MAWBackendBridge.re").getAllThreadsAsJson(a);a=function(){return b.sendAndReceive().then(function(a){return j(a)})};var c=function(a){return b.sendAndReceiveWithTimeout(a).then(function(a){return j(a)})};return{fireAndForget:b.fireAndForget,sendAndReceive:a,sendAndReceiveWithTimeout:c}}g.getAllThreadsAsJson=a}),98);
__d("MAWDYIRestoreThreadsFromOccamadilloDeferred.bs",["bs_curry","react","requireDeferred","useReStore"],(function(a,b,c,d,e,f){"use strict";var g,h=g||b("react"),i=b("requireDeferred")("MAWDYIRestoreThreadsFromOccamadillo.bs").__setRef("MAWDYIRestoreThreadsFromOccamadilloDeferred.bs");function a(a){var c=b("useReStore")();return h.useCallback(function(a){i.onReady(function(a){return b("bs_curry")._1(a.call,c)})},[c])}f.$MAWDYIRestoreThreadsFromOccamadillo$Deferred=i;f.useHook=a}),null);
__d("MAWDYIRestoreThreadsFromOccamadilloDeferred.re",["MAWDYIRestoreThreadsFromOccamadilloDeferred.bs"],(function(a,b,c,d,e,f){a=b("MAWDYIRestoreThreadsFromOccamadilloDeferred.bs").useHook;f.useHook=a}),null);
__d("EncryptedBackupsDYIPasswordReauthDialog.entrypoint",["EncryptedBackupsDYIPasswordReauthDialogQuery$Parameters","JSResourceForInteraction"],(function(a,b,c,d,e,f,g){"use strict";a=c("JSResourceForInteraction")("EncryptedBackupsDYIPasswordReauthDialog.react").__setRef("EncryptedBackupsDYIPasswordReauthDialog.entrypoint");b={getPreloadProps:function(){return{queries:{queryReference:{parameters:c("EncryptedBackupsDYIPasswordReauthDialogQuery$Parameters"),variables:{}}}}},root:a};g["default"]=b}),98);
__d("useEncryptedBackupsDYIPasswordReauthDialog",["EncryptedBackupsDYIPasswordReauthDialog.entrypoint","useCometEntryPointDialog"],(function(a,b,c,d,e,f,g){"use strict";function a(a){var b=a.onConfirm;a=c("useCometEntryPointDialog")(c("EncryptedBackupsDYIPasswordReauthDialog.entrypoint"),{});var d=a[0];return function(){return d({onConfirm:b})}}g["default"]=a}),98);
__d("useEncryptedBackupsDYIDownloader",["MAWBackendBridgeWrapper","MAWDYIRestoreThreadsFromOccamadilloDeferred.re","Promise","promiseDone","regeneratorRuntime","requireDeferred","useEncryptedBackupsDYIPasswordReauthDialog"],(function(a,b,c,d,e,f,g){"use strict";var h=c("requireDeferred")("file-saver").__setRef("useEncryptedBackupsDYIDownloader"),i=c("requireDeferred")("jszip").__setRef("useEncryptedBackupsDYIDownloader");function j(a){var c,e;return b("regeneratorRuntime").async(function(f){while(1)switch(f.prev=f.next){case 0:f.next=2;return b("regeneratorRuntime").awrap(d("MAWBackendBridgeWrapper").getAllThreadsAsJson().sendAndReceive());case 2:c=f.sent;e={};Object.keys(c).forEach(function(b){var d=c[b],f=d.messages,g=d.participants;d=d.stickers;f=f.map(function(a){a=a.value;var b=a.common;a=babelHelpers.objectWithoutPropertiesLoose(a,["common"]);return babelHelpers["extends"]({},b,a)});a.file("inbox/"+b+"/messages.json",JSON.stringify({messages:f,participants:g},null,4));["photos","videos","audio","gifs"].forEach(function(d){var e=c[b][d];Object.entries(e).forEach(function(c){var e=c[0];c=c[1];a.file("inbox/"+b+"/"+d+"/"+e,c)})});Object.entries(d).forEach(function(a){var b=a[0];a=a[1];e[b]=a})});Object.entries(e).forEach(function(b){var c=b[0];b=b[1];a.file("stickers_used/"+c,b)});return f.abrupt("return",b("Promise").resolve(a));case 7:case"end":return f.stop()}},null,this)}function k(a,b){h.onReady(function(c){c=c.saveAs;c(b,a)})}function a(){i.onReady(function(a){a=a();c("promiseDone")(j(a).then(function(a){return a.generateAsync({compression:"DEFLATE",compressionOptions:{level:6},type:"blob"})}).then(function(a){return k("messages.zip",a)}))})}function e(){return c("useEncryptedBackupsDYIPasswordReauthDialog")({onConfirm:c("MAWDYIRestoreThreadsFromOccamadilloDeferred.re").useHook()})}g.createFileAndDownload=a;g.useEncryptedBackupsDYIDownloader=e}),98);
__d("MAWBridgeUpdateDyiStatus.bs",["LSDatabaseDeferred.bs","LSEncryptedBackupsDYIState.bs","LSTransaction.bs","bs_caml_int64","promiseDone","useEncryptedBackupsDYIDownloader"],(function(a,b,c,d,e,f){"use strict";function a(a){b("useEncryptedBackupsDYIDownloader").createFileAndDownload()}function g(a,c){b("promiseDone")(b("LSTransaction.bs").run(a,function(a){return a.table("encrypted_backups_dyi_backup_restore_status").put({pk:b("bs_caml_int64").zero,currentStatus:c})},"readWrite"),void 0,void 0)}function c(a,c){return b("LSDatabaseDeferred.bs").db.then(function(a){var d=c.status;if(d){g(a,b("LSEncryptedBackupsDYIState.bs").backupRestoreSuccessful);b("useEncryptedBackupsDYIDownloader").createFileAndDownload();return}else return g(a,b("LSEncryptedBackupsDYIState.bs").backupRestoreError)})}f.createFileAndDownload=a;f.writeBackupRestoreStatus=g;f.call=c}),null);
__d("MAWBridgeUpdateTraceHandler.bs",["ArmadilloDataTraceCheckPoint.bs","LS.bs","LSAppendDataTraceAddon","LSDataTraceCheckPoint.bs","LSFlushDataTrace.bs","MAWBridgeTraceEvent.bs","MAWDualSendSimplePermissionsManager.bs","Promise","ReQL.bs","bs_caml","bs_caml_int64","killswitch"],(function(a,b,c,d,e,f){"use strict";function g(a,c,d){return b("ReQL.bs").toArray(b("ReQL.bs").filter(b("ReQL.bs").fromTableAscending(a.table("data_trace_meta")),function(a){var d=a.contextThree;if(d!==void 0&&c.externalIds.includes(d)&&b("bs_caml").i64_eq(a.traceType,c.traceType))return a.shouldFlush===!1;else return!1})).then(function(e){var f=[];return e.reduce(function(e,g){return e.then(function(e){f.push(g.traceId);e=c.errorMessage;if(e!==void 0)return b("LSAppendDataTraceAddon")(g.traceId,d,b("bs_caml_int64").neg_one,e,void 0,b("LS.bs").make(a));else return b("LSAppendDataTraceAddon")(g.traceId,d,b("bs_caml_int64").neg_one,void 0,void 0,b("LS.bs").make(a))})},b("Promise").resolve(void 0)).then(function(a){return f})})}function h(a,c){return c.reduce(function(c,d){return c.then(function(c){return b("LSFlushDataTrace.bs").updateAndFlushTrace(a,d)})},b("Promise").resolve(void 0))}function a(a,c){if(b("killswitch")("MESSENGER_WEB_DATA_TRACE_ID"))return window.Promise.resolve(void 0);var d=c.event;if(d===b("MAWBridgeTraceEvent.bs").receivedReceipt)return g(a,c,b("ArmadilloDataTraceCheckPoint.bs").deliveryReceiptReceived).then(function(b){return h(a,b)});else if(d===b("MAWBridgeTraceEvent.bs").receivedSent)return g(a,c,b("ArmadilloDataTraceCheckPoint.bs").advancedCryptoMEMSendTaskComplete).then(function(c){if(b("MAWDualSendSimplePermissionsManager.bs").isDualSendUser(void 0))return h(a,c);else return window.Promise.resolve(void 0)});else if(d===b("MAWBridgeTraceEvent.bs").flowEndForFailure)return g(a,c,b("LSDataTraceCheckPoint.bs").flowEndForFailure).then(function(b){return h(a,b)});else if(d===b("MAWBridgeTraceEvent.bs").flowEndForSuccess)return g(a,c,b("LSDataTraceCheckPoint.bs").flowEndAndFlush).then(function(b){return h(a,b)});else return window.Promise.resolve(void 0)}f.call=a}),null);
__d("LSBackupOperationType.bs",["bs_caml_int64"],(function(a,b,c,d,e,f){"use strict";a=b("bs_caml_int64").one;c=[0,2];f.upsertBackupItem=a;f.removeBackupItem=c}),null);
__d("MAWBridgeUploadMessageHandler.bs",["LS.bs","LSBackupOperationType.bs","LSDataTraceCheckPoint.bs","LSEncryptedBackupsBackupTenancy.bs","LSUploadMessage","MAWEncryptedBackupUtils.bs","MAWTraceUtils","Promise","bs_caml","bs_caml_int64"],(function(a,b,c,d,e,f){"use strict";function g(a,c,d){b("MAWTraceUtils").recordInvalidUploadRequestAndFlushTrace(a,c,d)}function h(a,c,d,e,f){b("MAWTraceUtils").recordCheckpointForTrace(a,c,d,e,f)}function a(a,c){var d=c.traceId;return b("MAWEncryptedBackupUtils.bs").getBackupTenancy(a,d).then(function(e){if(e!==void 0){if(b("bs_caml").i64_eq(e,b("LSEncryptedBackupsBackupTenancy.bs").production)){h(d,b("LSDataTraceCheckPoint.bs").labyrinthWebUploadInvokeMessageUploadSproc,[],!1,void 0);e=c.traceId;var f=c.echoDocument;if(e!==void 0)if(f==null)return b("LSUploadMessage")(c.threadId,c.messageId,b("bs_caml_int64").of_float(c.sortOrderMs),void 0,b("LSBackupOperationType.bs").removeBackupItem,e,b("LS.bs").make(a));else return b("LSUploadMessage")(c.threadId,c.messageId,b("bs_caml_int64").of_float(c.sortOrderMs),f,b("LSBackupOperationType.bs").upsertBackupItem,e,b("LS.bs").make(a));else if(f==null)return b("LSUploadMessage")(c.threadId,c.messageId,b("bs_caml_int64").of_float(c.sortOrderMs),void 0,b("LSBackupOperationType.bs").removeBackupItem,void 0,b("LS.bs").make(a));else return b("LSUploadMessage")(c.threadId,c.messageId,b("bs_caml_int64").of_float(c.sortOrderMs),f,b("LSBackupOperationType.bs").upsertBackupItem,void 0,b("LS.bs").make(a))}g(c.traceId,b("LSDataTraceCheckPoint.bs").labyrinthWebEchoMessageUploadInvalidRequest,[]);return b("Promise").resolve(void 0)}h(c.traceId,b("LSDataTraceCheckPoint.bs").labyrinthWebUploadUserDeviceNotEnrolled,[],!1,void 0);g(c.traceId,b("LSDataTraceCheckPoint.bs").labyrinthWebEchoMessageUploadInvalidRequest,[]);return b("Promise").resolve(void 0)})}f.recordInvalidUploadRequestAndFlushTrace=g;f.recordCheckpointForTrace=h;f.call=a}),null);
__d("MAWBridgeUploadThreadHandler.bs",["LS.bs","LSBackupOperationType.bs","LSEncryptedBackupsBackupTenancy.bs","LSUploadThread","MAWEncryptedBackupUtils.bs","MAWGating.bs","MAWTimeUtils","Promise","bs_caml","bs_caml_int64"],(function(a,b,c,d,e,f){"use strict";function a(a,c){if(c.actionType===b("bs_caml_int64").to_int32(b("LSBackupOperationType.bs").removeBackupItem)||b("MAWGating.bs").isLegacyThreadUploadEnabled(void 0)&&!b("MAWGating.bs").isOccamadillo(void 0))return b("MAWEncryptedBackupUtils.bs").getBackupTenancy(a,void 0).then(function(d){if(d===void 0)return b("Promise").resolve(void 0);if(!b("bs_caml").i64_eq(d,b("LSEncryptedBackupsBackupTenancy.bs").production))return b("Promise").resolve(void 0);d=c.echoDocument;if(d==null)return b("LSUploadThread")(c.threadId,c.folderType,c.transportKey,b("MAWTimeUtils").millisTimeToTimestamp(c.ts),void 0,b("LSBackupOperationType.bs").removeBackupItem,b("LS.bs").make(a));else return b("LSUploadThread")(c.threadId,c.folderType,c.transportKey,b("MAWTimeUtils").millisTimeToTimestamp(c.ts),d,b("LSBackupOperationType.bs").upsertBackupItem,b("LS.bs").make(a))});else return b("Promise").resolve(void 0)}f.call=a}),null);
__d("WAOfflineUtils",["$InternalEnum"],(function(a,b,c,d,e,f){"use strict";a=6e4;c=b("$InternalEnum").Mirrored(["OFFLINE_RESUME","ONLINE"]);d=b("$InternalEnum")({Initializing:"initializing",Failed:"failed",Processing:"processing",Complete:"complete"});f.OFFLINE_STANZA_TIMEOUT_MS=a;f.ServerRPCMode=c;f.OfflineStatus=d}),66);
__d("MAWSetupBridgeOfflineSnapshot",["MAWTTRC","WALogger","WAOfflineUtils","cr:4871","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["[OFFLINE] Stats end: "," / ",", messages: "," / ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[OFFLINE] Progress: "," / ",", messages: "," / ",""]);i=function(){return a};return a}function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["[OFFLINE] Stats start: ",", messages: ",""]);j=function(){return a};return a}a=function(a){var c,e,f,g,k;return b("regeneratorRuntime").async(function(l){while(1)switch(l.prev=l.next){case 0:c=a.downloaded,e=a.expected,f=a.processed,g=a.status;l.next=3;return b("regeneratorRuntime").awrap(b("cr:4871")==null?void 0:b("cr:4871")());case 3:k=l.sent;l.t0=g;l.next=l.t0===d("WAOfflineUtils").OfflineStatus.Initializing?7:l.t0===d("WAOfflineUtils").OfflineStatus.Processing?10:l.t0===d("WAOfflineUtils").OfflineStatus.Complete?12:l.t0===d("WAOfflineUtils").OfflineStatus.Failed?15:16;break;case 7:d("WALogger").LOG(j(),e.count,e.message);k==null?void 0:k.fireAndForget("event","uiUpdate",{events:[{tag:"InitOfflineQueueSyncStart",value:e.message}]});return l.abrupt("return",d("MAWTTRC").markEvent("offline_queue_start"));case 10:d("WALogger").LOG(i(),f.count,e.count,f.message,e.message);return l.abrupt("return",k==null?void 0:k.fireAndForget("event","uiUpdate",{events:[{tag:"InitOfflineQueueSyncProgress",value:f.message}]}));case 12:d("WALogger").LOG(h(),c.count,e.count,c.message,e.message);k==null?void 0:k.fireAndForget("event","uiUpdate",{events:[{tag:"InitOfflineQueueSyncComplete",value:void 0}]});return l.abrupt("return",d("MAWTTRC").markEvent("offline_queue_end"));case 15:return l.abrupt("return");case 16:case"end":return l.stop()}},null,this)};c=a;g["default"]=c}),98);
__d("XArmadilloWebRegisterPushInfoController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/messenger/armadillo/register/push_info/",{})}),null);
__d("MAWPushNotificationSetup",["MAWDbMetaTxns","MAWGating.re","MAWIndexedDb","MAWJobDefinitions","MAWTransactionMode","MAWUIJob","ODS","WALogger","XArmadilloWebRegisterPushInfoController","err","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";function h(){var a=babelHelpers.taggedTemplateLiteralLoose(["httpRegisterNotificationDevice: fail to initiate fetch: ",""]);h=function(){return a};return a}function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["httpRegisterNotificationDevice: fail to parse request body ",""]);i=function(){return a};return a}function a(){var a,c;return b("regeneratorRuntime").async(function(e){while(1)switch(e.prev=e.next){case 0:if(d("MAWGating.re").isPushNotificationEnabled()){e.next=2;break}return e.abrupt("return");case 2:d("ODS").bumpEntityKey(3185,"armadillo_push_notification","registration_attempt");e.next=5;return b("regeneratorRuntime").awrap(j());case 5:a=e.sent;e.t0=a.status;e.next=e.t0===200?9:20;break;case 9:e.prev=9;e.next=12;return b("regeneratorRuntime").awrap(a.json());case 12:c=e.sent;d("MAWUIJob").UIJobStarters.fireAndForget(d("MAWJobDefinitions").jobSerializers.sendPushNotificationSetup(""+c.appId,c.actDeviceId,"fb"));e.next=19;break;case 16:e.prev=16,e.t1=e["catch"](9),d("WALogger").ERROR(i(),e.t1);case 19:return e.abrupt("return");case 20:return e.abrupt("return");case 21:case"end":return e.stop()}},null,this,[[9,16]])}function j(){var a,e,f,g,i;return b("regeneratorRuntime").async(function(j){while(1)switch(j.prev=j.next){case 0:a=c("XArmadilloWebRegisterPushInfoController").getURIBuilder().getURI().toString();e={};j.next=10;break;f=d("MAWIndexedDb").makeMsgrTransactor({meta:d("MAWTransactionMode").READONLY})(d("MAWDbMetaTxns").getPushMetaData);j.next=6;return b("regeneratorRuntime").awrap(f().then(function(a){return a.deviceUUID}));case 6:g=j.sent;if(!(g==null)){j.next=9;break}throw c("err")("deviceUUID is null, unable to proceed");case 9:e={body:"device_id="+encodeURIComponent(g)};case 10:j.prev=10;j.next=13;return b("regeneratorRuntime").awrap(fetch(a,babelHelpers["extends"]({method:"POST"},e)));case 13:i=j.sent;j.next=20;break;case 16:j.prev=16;j.t0=j["catch"](10);d("WALogger").ERROR(h(),j.t0);throw j.t0;case 20:return j.abrupt("return",i);case 21:case"end":return j.stop()}},null,this,[[10,16]])}g.setupArmadilloPushNotifications=a}),98);
__d("MAWDYIRestoreThreadsFromOccamadillo.bs",["LS.bs","LSEncryptedBackupsDYIState.bs","LSThreadsRangesQuery","LSTransaction.bs","MAWBackendBridge.bs","MAWGating.bs","MAWJids","Promise","ReQL.bs","SortedAsyncIterable.bs","WALogger.bs","bs_caml","bs_caml_int64","bs_curry","bs_int64","promiseDone"],(function(a,b,c,d,e,f){"use strict";var g={contents:b("bs_caml_int64").zero},h={contents:b("bs_caml_int64").zero};function i(a){var c=[],d=[];b("promiseDone")(b("ReQL.bs").toArray(b("ReQL.bs").fromTableAscending(a.table("mi_act_mapping_table"))).then(function(e){b("promiseDone")(e.reduce(function(e,f){return e.then(function(e){return b("ReQL.bs").first(b("ReQL.bs").getKeyRange(b("ReQL.bs").fromTableAscending(a.table("threads")),{hd:f.serverThreadKey,tl:0})).then(function(a){if(a===void 0)return;a=a.threadType;if(b("bs_caml").i64_neq(a,[0,15])){if(b("bs_caml").i64_neq(a,[0,16]))return;a=b("bs_int64").to_string(f.jid);c.push(b("MAWJids").toGroupJid(a));return}a=b("bs_int64").to_string(f.jid);d.push(b("MAWJids").toUserJid(a))})})},b("Promise").resolve(void 0)).then(function(a){return b("bs_curry")._1(b("MAWBackendBridge.bs").dyiGetThreadList({threadJids:c.concat(d)}).fireAndForget,void 0)}),void 0,void 0)}),void 0,void 0)}function j(a){var c=b("ReQL.bs").fromTableAscending(a.table("inbox_threads_ranges")),d={contents:function(a){}};d.contents=b("SortedAsyncIterable.bs").subscribe(c,function(c,e){if(typeof e==="number")return;if(e.TAG===0)return;var f=e._0;c=f.syncGroup;if(b("bs_caml").i64_neq(c,[0,95]))return;else if(f.hasMoreBefore)if(b("bs_caml").i64_neq(f.minThreadKey,g.contents)||b("bs_caml").i64_neq(f.minLastActivityTimestampMs,h.contents)){g.contents=f.minThreadKey;h.contents=f.minLastActivityTimestampMs;b("promiseDone")(b("LSTransaction.bs").run(a,function(a){return b("LSThreadsRangesQuery")(b("bs_caml_int64").zero,!0,!1,f.minThreadKey,b("bs_int64").max_int,b("bs_int64").max_int,f.minLastActivityTimestampMs,b("bs_caml_int64").zero,b("LS.bs").make(a))},"readWrite"),void 0,void 0);return}else return;else{b("bs_curry")._1(d.contents,void 0);return i(a)}});return b("Promise").resolve(void 0)}function k(a){b("promiseDone")(b("ReQL.bs").toArray(b("ReQL.bs").fromTableAscending(a.table("inbox_threads_ranges"))).then(function(c){c.forEach(function(c){var d=c.syncGroup;if(b("bs_caml").i64_neq(d,[0,95]))return;else if(c.hasMoreBefore){b("promiseDone")(j(a).then(function(d){g.contents=c.minThreadKey;h.contents=c.minLastActivityTimestampMs;return b("LSTransaction.bs").run(a,function(a){return b("LSThreadsRangesQuery")(b("bs_caml_int64").zero,!0,!1,c.minThreadKey,b("bs_int64").max_int,b("bs_int64").max_int,c.minLastActivityTimestampMs,b("bs_caml_int64").zero,b("LS.bs").make(a))},"readWrite")}),void 0,void 0);return}else return i(a)})}),void 0,void 0)}function a(a){if(b("MAWGating.bs").isOccamadillo(void 0)&&b("MAWGating.bs").isDyiEnabled(void 0)){b("promiseDone")(b("LSTransaction.bs").run(a,function(a){return a.table("encrypted_backups_dyi_backup_restore_status").put({pk:b("bs_caml_int64").zero,currentStatus:b("LSEncryptedBackupsDYIState.bs").backupRestoreInProgress})},"readWrite").then(function(b){return k(a)}),void 0,void 0);return}else return b("WALogger.bs").warn("User not enrolled in Occamadillo, cannot restore threads and initiate DYI")}f.prevMinThreadKey=g;f.prevMinLastActivityTs=h;f.processThreadsForDyi=i;f.registerListenerOnInboxThreadsRanges=j;f.getAllOccamadilloThreadsFromMailbox=k;f.call=a}),null);
__d("ArmadilloCutoverClientFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f){"use strict";a=b("getFalcoLogPolicy_DO_NOT_USE")("699");c=b("FalcoLoggerInternal").create("armadillo_cutover_client",a);e.exports=c}),null);